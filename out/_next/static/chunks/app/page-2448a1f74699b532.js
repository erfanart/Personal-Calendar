(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3244:(e,t,n)=>{Promise.resolve().then(n.bind(n,4372))},4372:(e,t,n)=>{"use strict";n.d(t,{default:()=>z});var a=n(5155),l=n(2115),s=n(1471),i=n(760),r=n(9684),o=n(2321),d=n(2641),c=n(9509);let x=new r.R({link:new o.P({uri:c.env.NEXT_PUBLIC_GRAPHQL_API_URL||"http://calendar.rcsis.ir:8000/graphql",headers:{"Content-Type":"application/json"},fetch:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return fetch(...t)}}),cache:new d.D,defaultOptions:{query:{fetchPolicy:"network-only",errorPolicy:"all"}}});var u=n(5933),m=n(6112);function h(){let e=(0,u._)(["\n  mutation UpsertNote($text: String!, $timeSlotId: Int!) {\n    upsertNote(text: $text, timeSlotId: $timeSlotId) {\n      id\n      text\n    }\n  }\n"]);return h=function(){return e},e}function p(){let e=(0,u._)(["\n  mutation UpsertTags($timeSlotId: Int!, $tagNames: [String!]!) {\n    upsertTags(timeSlotId: $timeSlotId, tagNames: $tagNames) {\n      id\n      name\n    }\n  }\n"]);return p=function(){return e},e}let f=(0,m.J1)(h()),g=(0,m.J1)(p()),y=e=>{let{note:t,onSave:n,timeSlotId:s}=e,i=t||{text:""},[r,o]=(0,l.useState)(!1),[d,c]=(0,l.useState)(i.text),[u,m]=(0,l.useState)(!1),[h,p]=(0,l.useState)(null),g=(0,l.useRef)(null);(0,l.useEffect)(()=>{c(i.text)},[i.text]),(0,l.useEffect)(()=>{r&&g.current&&(g.current.focus(),g.current.selectionStart=g.current.value.length)},[r]);let y=async()=>{if(!s){p("Time slot ID is missing");return}m(!0),p(null);try{await x.mutate({mutation:f,variables:{text:d,timeSlotId:s}}),n&&n(d),o(!1)}catch(e){p("Failed to save note"),console.error("Error saving note:",e)}finally{m(!1)}};return(0,a.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,a.jsx)("div",{className:"flex justify-end mb-2",children:r?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:y,className:"text-green-500 hover:text-green-700 text-sm px-3 py-1 rounded hover:bg-green-50",disabled:u,children:u?"در حال ذخیره...":"ذخیره"}),(0,a.jsx)("button",{onClick:()=>{c(i.text),o(!1)},className:"text-red-500 hover:text-red-700 text-sm px-3 py-1 rounded hover:bg-red-50",disabled:u,children:"انصراف"})]}):(0,a.jsx)("button",{onClick:()=>o(!0),className:"text-blue-500 hover:text-blue-700 text-sm px-3 py-1 rounded hover:bg-blue-50",disabled:u,children:"ویرایش"})}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm mb-2 text-center",children:h}),r?(0,a.jsx)("textarea",{ref:g,value:d,onChange:e=>c(e.target.value),className:"w-full flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"یادداشت خود را بنویسید...",disabled:u}):(0,a.jsx)("div",{className:"flex-1 p-3 bg-gray-50 rounded-md whitespace-pre-wrap overflow-y-auto",onClick:()=>!u&&o(!0),children:i.text||(0,a.jsx)("span",{className:"text-gray-400",children:"یادداشت بدون متن"})})]})};var v=n(4416);let b=e=>{let{text:t,onRemove:n,className:l="",removable:s=!0}=e;return(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 bg-blue-100 text-blue-800 rounded-full px-3 py-1 text-sm ".concat(l),children:[(0,a.jsx)("span",{children:t}),s&&n&&(0,a.jsx)("button",{onClick:n,className:"text-blue-500 hover:text-blue-700 focus:outline-none","aria-label":"Remove tag ".concat(t),children:(0,a.jsx)(v.A,{size:14})})]})};var j=n(6474);let N=(0,l.memo)(e=>{let{timeSlotId:t,initialTags:n=[],onTagsChange:s,placeholder:i="Add a tag...",maxTags:r,maxWidth:o=300}=e,[d,c]=(0,l.useState)(n),[u,m]=(0,l.useState)(""),[h,p]=(0,l.useState)(!1),[f,y]=(0,l.useState)(!1),[v,N]=(0,l.useState)(!1),w=(0,l.useRef)(null),S=(0,l.useRef)(null),k=(0,l.useCallback)(async e=>{N(!0);try{let{data:n}=await x.mutate({mutation:g,variables:{timeSlotId:t,tagNames:e}});return n.upsertTags.map(e=>e.name)}catch(e){throw console.error("Failed to update tags:",e),e}finally{N(!1)}},[t]),C=(0,l.useCallback)(async e=>{c(e);try{let t=await k(e);t&&c(t),null==s||s(t||e)}catch(e){console.error(e),c(n)}},[k,s,n]);(0,l.useEffect)(()=>{let e=w.current,t=S.current;if(!e||!t)return;let n=()=>{let n=e.clientWidth,a=t.scrollWidth;p(a>n),a<=n&&y(!1)},a=new ResizeObserver(n);return a.observe(e),a.observe(t),n(),()=>a.disconnect()},[d]);let I=(0,l.useCallback)(()=>{let e=u.trim();e&&!d.includes(e)&&(!r||d.length<r)&&(C([...d,e]),m(""))},[u,d,r,C]),P=(0,l.useCallback)(e=>{let t=d.filter(t=>t!==e);C(t),t.length<=1&&y(!1)},[d,C]),D=(0,l.useCallback)(e=>{"Enter"===e.key?(e.preventDefault(),I()):"Backspace"!==e.key||u||P(d[d.length-1])},[I,P,u,d]),$=(0,l.useCallback)(()=>{y(e=>!e)},[]),_=h?d.slice(0,1):d,T=h?d.length-1:0,E=!r||d.length<r;return(0,a.jsxs)("div",{className:"space-y-2 w-full",children:[(0,a.jsxs)("div",{ref:w,className:"\n          flex items-center gap-2 p-1 border border-gray-200 rounded-md\n          ".concat(h?"overflow-x-auto max-h-20":"overflow-hidden","\n          transition-all duration-200 \n          ").concat(v?"opacity-70":"","\n        "),style:{maxWidth:"".concat(o,"px")},children:[(0,a.jsx)("div",{ref:S,className:"flex items-center gap-2 flex-nowrap",style:{visibility:"hidden",position:"absolute"},children:d.map(e=>(0,a.jsx)(b,{text:e,onRemove:()=>{}},e))}),_.map(e=>(0,a.jsx)(b,{text:e,onRemove:v?void 0:()=>P(e)},e)),T>0&&(0,a.jsxs)("button",{onClick:$,className:"flex items-center text-sm text-gray-500 hover:text-gray-700","aria-expanded":f,disabled:v,children:["+",T,(0,a.jsx)(j.A,{size:16,className:"transition-transform ".concat(f?"rotate-180":"")})]}),E&&(0,a.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),onKeyDown:D,onBlur:I,placeholder:0===d.length?i:"",className:"flex-1 min-w-[100px] px-2 py-1 focus:outline-none","aria-label":"Add tag",disabled:v})]}),h&&f&&(0,a.jsx)("div",{className:"mt-1 p-2 border border-gray-200 rounded-md shadow-sm bg-white",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:d.slice(1).map(e=>(0,a.jsx)(b,{text:e,onRemove:v?void 0:()=>P(e)},e))})}),v&&(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"Saving tags..."})]})});N.displayName="TagInput";let w=e=>{let{timeSlots:t,onNoteUpdate:n}=e,[r,o]=(0,l.useState)(()=>t.map(e=>({...e,note:e.note?{...e.note}:{id:-1,text:"",timeSlotId:e.id},tags:e.tags?[...e.tags]:[]}))),[d,c]=(0,l.useState)(null);if(0===t.length)return null;let x=e=>{let t="string"==typeof e?parseInt(e):e;return"".concat(t.toString().padStart(2,"0"),":00")},u=(e,t)=>{o(n=>n.map(n=>n.id===e?{...n,note:{...n.note,text:t}}:n)),n&&n(e,t)};return(0,a.jsx)(a.Fragment,{children:r.map((e,t)=>{var n,l;return(0,a.jsxs)("div",{className:"border p-2 rounded-lg h-40 flex flex-col bg-white shadow-sm mb-2 transition-all duration-200 ease-in-out",dir:"rtl",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("span",{className:"text-xs text-gray-600",children:[x(e.hour)," - ",x((e.hour+1)%24)]})}),(0,a.jsx)(N,{timeSlotId:e.id,initialTags:e.tags.map(e=>e.name),onTagsChange:e=>{console.log("Tags updated:",e)},placeholder:"+ Add tag",maxTags:10}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(s.P.div,{whileHover:{y:-3,scale:1.01},whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:()=>c(t),transition:{delay:.03*t,type:"spring",stiffness:400},className:"cursor-pointer border border-gray-200 p-2 rounded-lg hover:shadow-md hover:border-blue-400 hover:bg-blue-50 hover:transform hover:-translate-y-0.5",dir:"rtl",children:(null===(n=e.note)||void 0===n?void 0:n.text)||(0,a.jsx)("span",{className:"text-gray-400",children:"یاداشت"})},"slot-note-".concat(e.id))}),(0,a.jsx)(i.N,{children:d===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 backdrop-blur-[2px] z-10",onClick:()=>c(null)}),(0,a.jsx)(s.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-20 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full h-full max-w-6xl mx-auto flex flex-col bg-white rounded-xl shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:"یاداشت"}),(0,a.jsx)("button",{onClick:()=>c(null),className:"text-gray-500 hover:text-gray-700 text-2xl p-1",children:"\xd7"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,a.jsx)(y,{note:null===(l=r[t])||void 0===l?void 0:l.note,onSave:t=>u(e.id,t),timeSlotId:e.id})})]})},"note-modal-".concat(e.id))]})})]},"slot-container-".concat(e.id))})})};function S(){let e=(0,u._)(["\n  query MyQuery {\n    getMonths {\n      id\n      name\n      season\n    }\n  }\n"]);return S=function(){return e},e}function k(){let e=(0,u._)(["\n  query GetTags($search: String!) {\n    tags(search: $search) {\n      id\n      name\n    }\n  }\n"]);return k=function(){return e},e}function C(){let e=(0,u._)(["\n  mutation UpdateTags($objectId: ID!, $tags: [String!]!) {\n    updateTags(objectId: $objectId, tags: $tags) {\n      id\n      tags\n    }\n  }\n"]);return C=function(){return e},e}function I(){let e=(0,u._)(["\n  query GetMonthDetails($id: Int!) {\n    getMonths(id: $id){\n      id\n      name\n      season\n      calendarDays {\n        dayName\n        id\n        jalaliDate\n        timeSlots {\n          hour\n          id\n          note {\n            id\n            text\n          }\n          tags {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"]);return I=function(){return e},e}function P(){let e=(0,u._)(["\nquery GetDayDetails($id: Int = 1) {\n  getCalendarDays(id: $id) {\n    id\n    dayName\n    jalaliDate\n    timeSlots {\n      hour\n      id\n      note {\n        id\n        text\n      }\n      tags {\n        id\n        name\n      }\n    }\n  }\n}"]);return P=function(){return e},e}function D(){let e=(0,u._)(["\n  query MyQuery {\n    getMonths {\n      name\n      season\n      calendarDays {\n        dayName\n        id\n        jalaliDate\n        timeSlots {\n          hour\n          id\n        }\n      }\n    }\n  }\n"]);return D=function(){return e},e}(0,m.J1)(S()),(0,m.J1)(k()),(0,m.J1)(C());let $=(0,m.J1)(I()),_=(0,m.J1)(P());(0,m.J1)(D());var T=n(5826);let E=["شنبه","یکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه"],F=e=>{let{days:t}=e,[n,r]=(0,l.useState)(null),[o,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null),p=e=>{let t="string"==typeof e?parseInt(e):e;return"".concat(t.toString().padStart(2,"0"),":00")};if((0,l.useEffect)(()=>{(async()=>{if(null!==n){u(!0),h(null);try{let{data:e}=await x.query({query:_,variables:{id:t[n].id}});d(e.getCalendarDays[0])}catch(e){h("Failed to load day details"),console.error("Error fetching day details:",e)}finally{u(!1)}}})()},[n,t]),!t||0===t.length)return null;let f=(e=>E.includes(e)?E.indexOf(e):(console.error("Invalid day name received: ".concat(e)),0))(t[0].dayName),g=Array.from({length:f});return(0,a.jsxs)(a.Fragment,{children:[g.map((e,t)=>(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:.5},transition:{delay:.02*t},className:"h-40 rounded border border-gray-100 bg-gray-50"},"empty-".concat(t))),t.map((e,t)=>(0,a.jsxs)(l.Fragment,{children:[(0,a.jsxs)(s.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileTap:{scale:.9},onClick:()=>r(t),transition:{delay:(f+t)*.03,type:"spring",stiffness:300},className:"border p-2 rounded-lg h-40 flex flex-col bg-white shadow-sm ease-in-out hover:shadow-md hover:border-blue-400 hover:bg-blue-50 hover:transform hover:-translate-y-0.5 cursor-pointer",dir:"rtl",children:[(0,a.jsxs)("div",{className:"mb-1 border-b pb-1",children:[(0,a.jsx)("h3",{className:"font-medium text-sm text-gray-700",children:e.dayName}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.jalaliDate.split("-").join("/")})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto",children:(0,a.jsx)("div",{className:"block md:hidden sm:hidden",children:e.timeSlots.map(e=>{var t;let n="string"==typeof e.hour?parseInt(e.hour):e.hour;return(0,a.jsxs)("div",{className:"text-xs py-1 text-right text-gray-600 ".concat((null===(t=e.note)||void 0===t?void 0:t.text)||e.tags.length>0?"":"bg-red-100"),children:[p(n)," - ",p((n+1)%24)]},e.id)})})})]},"day-".concat(e.id)),(0,a.jsx)(i.N,{children:n===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 backdrop-blur-[2px] z-20",onClick:()=>{r(null),d(null)}}),(0,a.jsx)(s.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300},className:"fixed inset-0 z-30 flex items-center justify-center p-4 flex-col",children:(0,a.jsxs)("div",{className:"w-full h-full max-w-6xl mx-auto flex flex-col bg-white rounded-xl shadow-2xl overflow-hidden",children:[(0,a.jsx)("div",{className:"flex justify-between items-center p-4 border-b",children:c?(0,a.jsx)("div",{className:"flex-1 flex justify-center",children:(0,a.jsx)(T.A,{size:24,color:"#3b82f6"})}):m?(0,a.jsx)("div",{className:"text-red-500",children:m}):(0,a.jsxs)(a.Fragment,{children:[console.log(o),(0,a.jsx)("h3",{className:"text-lg font-bold",children:e.dayName}),(0,a.jsx)("p",{children:e.jalaliDate.split("-").join("/")}),(0,a.jsx)("button",{onClick:()=>{r(null),d(null)},className:"text-gray-500 hover:text-gray-700 text-2xl p-1","aria-label":"Close",children:"\xd7"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 pb-1",children:c?(0,a.jsx)("div",{className:"flex-1 flex justify-center",children:(0,a.jsx)(T.A,{size:24,color:"#3b82f6"})}):m?(0,a.jsx)("div",{className:"text-red-500",children:m}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(w,{timeSlots:(null==o?void 0:o.timeSlots)||[]})})})]})},"day-popup-".concat(n))]})})]},"day-container-".concat(e.id)))]})},z=e=>{let{months:t}=e,[n,r]=(0,l.useState)(null),[o,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null);return(0,l.useEffect)(()=>{(async()=>{if(n){u(!0),h(null);try{let{data:e}=await x.query({query:$,variables:{id:n}}),t=e.getMonths&&e.getMonths.length?e.getMonths[0]:null;if(!t)throw Error("Month data not found");d(t)}catch(e){h("Failed to load month details"),console.error("Error fetching month details:",e)}finally{u(!1)}}})()},[n]),(0,a.jsxs)("div",{className:"relative",dir:"rtl",children:[(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 p-3 transition-all duration-300 ".concat(null!==n?"blur-[2px]":""),children:t.map(e=>(0,a.jsxs)(s.P.div,{whileHover:{y:-3,scale:1.01},whileTap:{scale:.95},transition:{type:"spring",stiffness:400},onClick:()=>r(e.id),className:" p-3 rounded-lg border border-gray-200 bg-white shadow-sm cursor-pointer text-center flex flex-col items-center justify-center h-28 sm:h-32 hover:bg-blue-50 hover:border-blue-200 ",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-500",children:"ماه"}),(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-gray-800 mt-1",children:e.name})]},"month-".concat(e.id)))}),(0,a.jsx)(i.N,{children:null!==n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/30 z-10 backdrop-blur-[2px]",onClick:()=>{r(null),d(null)}}),(0,a.jsx)(s.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300},className:"fixed inset-0 z-20 flex items-center justify-center p-2 sm:w-[95%] sm:max-w-5xl p-2 sm:p-4",children:(0,a.jsxs)("div",{className:"w-full h-[80vh] sm:h-[90vh] md:h-[95vh] mx-auto max-w-5xl flex flex-col bg-white rounded-lg sm:rounded-xl shadow-2xl overflow-hidden",children:[(0,a.jsx)("div",{className:"flex justify-between items-center p-3 sm:p-4 border-b",children:c?(0,a.jsx)("div",{className:"flex-1 flex justify-center",children:(0,a.jsx)(T.A,{size:20,color:"#3b82f6"})}):m?(0,a.jsx)("div",{className:"text-red-500 text-sm sm:text-base",children:m}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("h2",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:["تقویم ",null==o?void 0:o.name]}),(0,a.jsx)("button",{onClick:()=>{r(null),d(null)},className:"text-gray-500 hover:text-gray-700 text-xl sm:text-2xl p-1",children:"\xd7"})]})}),c?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-4 sm:p-8",children:(0,a.jsx)(T.A,{size:30,color:"#3b82f6"})}):m?(0,a.jsx)("div",{className:"p-4 sm:p-8 text-center text-red-500",children:m}):o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.P.div,{className:"mb-2 grid grid-cols-7 gap-1 px-1 sm:px-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:E.map(e=>(0,a.jsx)("div",{className:"rounded-md bg-gray-100 py-1 sm:py-2 text-center text-xs sm:text-sm font-medium text-gray-600",children:e},"header-".concat(e)))}),(0,a.jsx)("div",{className:"overflow-y-auto flex-1 grid grid-cols-7 gap-1 px-1 sm:px-2 pb-2",children:(0,a.jsx)(F,{days:o.calendarDays})})]})]})},"month-".concat(n))]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[369,441,684,358],()=>t(3244)),_N_E=e.O()}]);